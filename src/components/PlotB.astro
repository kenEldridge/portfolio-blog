---
// Panel B: Total dissonance
---

<div id="plot-b"></div>

<script>
	import Plotly from 'plotly.js-dist-min';

	function roughness(deltaF, cbw = 100) {
		const x = deltaF / cbw;
		return Math.exp(-3.5 * x) - Math.exp(-5.75 * x);
	}

	const f0 = 200.0;
	const numPartials = 30;
	const partials = Array.from({length: numPartials}, (_, i) => i + 1);

	const intervals = [
		{name: 'Major third (5:4)', ratio: 5/4},
		{name: 'Perfect fourth (4:3)', ratio: 4/3},
		{name: 'Perfect fifth (3:2)', ratio: 3/2},
		{name: 'Octave (2:1)', ratio: 2.0}
	];

	const ratiosB = Array.from({length: 600}, (_, i) => 1.0 + i * (1.0 / 599));
	const fA = partials.map(p => p * f0);

	const dissonance = ratiosB.map(r => {
		const fB = partials.map(p => p * f0 * r);
		let sum = 0;
		for (let i = 0; i < fA.length; i++) {
			for (let j = 0; j < fB.length; j++) {
				sum += roughness(Math.abs(fA[i] - fB[j]));
			}
		}
		return sum;
	});

	const traceB = {
		x: ratiosB,
		y: dissonance,
		type: 'scatter',
		mode: 'lines',
		line: {color: '#64b5f6', width: 2},
		name: 'Total dissonance'
	};

	const shapesB = intervals.map(interval => ({
		type: 'line',
		x0: interval.ratio,
		x1: interval.ratio,
		y0: 0,
		y1: 1,
		yref: 'paper',
		line: {color: 'rgba(255,255,255,0.4)', width: 1, dash: 'dot'}
	}));

	const layoutB = {
		xaxis: {title: 'Frequency ratio (interval)', gridcolor: 'rgba(255,255,255,0.2)'},
		yaxis: {title: 'Summed dissonance', gridcolor: 'rgba(255,255,255,0.2)'},
		paper_bgcolor: '#000000',
		plot_bgcolor: '#000000',
		font: {color: 'white'},
		shapes: shapesB,
		showlegend: false,
		margin: {l: 60, r: 20, t: 20, b: 60}
	};

	const config = {responsive: true};
	Plotly.newPlot('plot-b', [traceB], layoutB, config);
</script>

<style>
	#plot-b {
		width: 100%;
		height: 400px;
		margin: 1.5rem 0;
	}
</style>
